
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>neclib.device_control.antenna_pid module &#8212; neclib 0.1.0 documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="https://avatars.githubusercontent.com/u/20414019?s=400&amp;u=0e47c7d5efc6cf27086c8cfcdb6fd5c757926043&amp;v=4"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="neclib.utils package" href="neclib.utils.html" />
    <link rel="prev" title="neclib.device_control package" href="neclib.device_control.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../index.html">
<p class="title">neclib</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Home
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="neclib.html">
  API Documentation
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/nanten2/neclib" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://pypi.org/project/neclib/" rel="noopener" target="_blank" title="PyPI">
            <span><i class="fas fa-cubes"></i></span>
            <label class="sr-only">PyPI</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><!DOCTYPE html>
<!-- This will display the version of the docs -->
<p style="text-align: center; font-family: Verdana, sans-serif;">v0.1.0</p><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="neclib.device_control.html">
   neclib.device_control package
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     neclib.device_control.antenna_pid module
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="neclib.utils.html">
   neclib.utils package
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="neclib.utils.data_utils.html">
     neclib.utils.data_utils module
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="neclib.utils.math_utils.html">
     neclib.utils.math_utils module
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="neclib.utils.quantity_utils.html">
     neclib.utils.quantity_utils module
    </a>
   </li>
  </ul>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="neclib.typing.html">
   neclib.typing module
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="module-neclib.device_control.antenna_pid">
<span id="neclib-device-control-antenna-pid-module"></span><h1>neclib.device_control.antenna_pid module<a class="headerlink" href="#module-neclib.device_control.antenna_pid" title="Permalink to this headline">¶</a></h1>
<p>PID controller for telescope main dish.</p>
<p>Optimum control parameter is calculated using a simple function consists of
Proportional, Integral and Derivative terms:</p>
<div class="math notranslate nohighlight">
\[u(t) = K_\mathrm{p} \, e(t)
+ K_\mathrm{i} \int e(\tau) \, \mathrm{d}\tau
+ K_\mathrm{d} \frac{ \mathrm{d}e(t) }{ \mathrm{d}t }\]</div>
<p>where <span class="math notranslate nohighlight">\(K_\mathrm{p}, K_\mathrm{i}\)</span> and <span class="math notranslate nohighlight">\(K_\mathrm{d}\)</span> are free parameters,
<span class="math notranslate nohighlight">\(u(t)\)</span> is the parameter to control, and <span class="math notranslate nohighlight">\(e(t)\)</span> is the error between command
value and actual value of reference parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This script will be executed in high frequency with no vectorization, and there are
many arrays updated frequently. These mean that the use of Numpy may not be the best
choice to speed up the calculation. Measure the execution time first, then
implement.</p>
</div>
<dl class="py class">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">neclib.device_control.antenna_pid.</span></span><span class="sig-name descname"><span class="pre">PIDController</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pid_param</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_speed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_acceleration</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">error_integ_count</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/neclib/device_control/antenna_pid.html#PIDController"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>PID controller for telescope antenna.</p>
<p>PID controller, a classical but sophisticated controller for system which has some
delay on response to some input.</p>
<p class="rubric">Notes</p>
<p>This controller adds constant term to the general PID formulation. This is an
attempt to follow constant motions such as raster scanning and sidereal motion
tracking.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When you are to assign <code class="docutils literal notranslate"><span class="pre">ANGLE_UNIT</span></code> other than its default value, <code class="docutils literal notranslate"><span class="pre">deg</span></code>, you
should fix the values of <code class="docutils literal notranslate"><span class="pre">MAX_SPEED</span></code>, <code class="docutils literal notranslate"><span class="pre">MAX_ACCELERATION</span></code>, and <code class="docutils literal notranslate"><span class="pre">THRESHOLD</span></code>.</p>
</div>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">controller</span> <span class="o">=</span> <span class="n">PIDController</span><span class="p">(</span><span class="n">pid_param</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">speed</span> <span class="o">=</span> <span class="n">controller</span><span class="o">.</span><span class="n">get_speed</span><span class="p">(</span><span class="n">target_coordinate</span><span class="p">,</span> <span class="n">encoder_reading</span><span class="p">)</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Attributes</dt>
<dd class="field-odd"><dl class="simple">
<dt><a class="reference internal" href="#neclib.device_control.antenna_pid.PIDController.dt" title="neclib.device_control.antenna_pid.PIDController.dt"><code class="xref py py-obj docutils literal notranslate"><span class="pre">dt</span></code></a></dt><dd><p>Time interval of last 2 PID calculations.</p>
</dd>
<dt><a class="reference internal" href="#neclib.device_control.antenna_pid.PIDController.error_derivative" title="neclib.device_control.antenna_pid.PIDController.error_derivative"><code class="xref py py-obj docutils literal notranslate"><span class="pre">error_derivative</span></code></a></dt><dd><p>Derivative of error.</p>
</dd>
<dt><a class="reference internal" href="#neclib.device_control.antenna_pid.PIDController.error_integral" title="neclib.device_control.antenna_pid.PIDController.error_integral"><code class="xref py py-obj docutils literal notranslate"><span class="pre">error_integral</span></code></a></dt><dd><p>Integral of error.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Methods</p>
<table class="longtable table autosummary">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#neclib.device_control.antenna_pid.PIDController.get_speed" title="neclib.device_control.antenna_pid.PIDController.get_speed"><code class="xref py py-obj docutils literal notranslate"><span class="pre">get_speed</span></code></a>(cmd_coord, enc_coord[, stop])</p></td>
<td><p>Calculate valid drive speed.</p></td>
</tr>
</tbody>
</table>
<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.K_p">
<span class="sig-name descname"><span class="pre">K_p</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">1.0</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.K_p" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.K_i">
<span class="sig-name descname"><span class="pre">K_i</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.5</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.K_i" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.K_d">
<span class="sig-name descname"><span class="pre">K_d</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">0.3</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.K_d" title="Permalink to this definition">¶</a></dt>
<dd><p>Free parameters for PID.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.ANGLE_UNIT">
<span class="sig-name descname"><span class="pre">ANGLE_UNIT</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'deg'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'arcmin'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'arcsec'</span></span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">'deg'</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.ANGLE_UNIT" title="Permalink to this definition">¶</a></dt>
<dd><p>Unit in which all public functions accept as its argument and return.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.MAX_SPEED">
<span class="sig-name descname"><span class="pre">MAX_SPEED</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2.0</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.MAX_SPEED" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum speed for telescope motion.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.MAX_ACCELERATION">
<span class="sig-name descname"><span class="pre">MAX_ACCELERATION</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">2.0</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.MAX_ACCELERATION" title="Permalink to this definition">¶</a></dt>
<dd><p>Maximum acceleration for telescope motion.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.ERROR_INTEG_COUNT">
<span class="sig-name descname"><span class="pre">ERROR_INTEG_COUNT</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">int</span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">50</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.ERROR_INTEG_COUNT" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of error data to be stored for integral term calculation.</p>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.THRESHOLD">
<span class="sig-name descname"><span class="pre">THRESHOLD</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></em><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">{'accel_limit_off':</span> <span class="pre">0.005555555555555556,</span> <span class="pre">'cmd_coord_change':</span> <span class="pre">0.027777777777777776,</span> <span class="pre">'target_accel_ignore':</span> <span class="pre">2}</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.THRESHOLD" title="Permalink to this definition">¶</a></dt>
<dd><p>Thresholds for conditional executions.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.dt">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">dt</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.dt" title="Permalink to this definition">¶</a></dt>
<dd><p>Time interval of last 2 PID calculations.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.error_integral">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">error_integral</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.error_integral" title="Permalink to this definition">¶</a></dt>
<dd><p>Integral of error.</p>
</dd></dl>

<dl class="py property">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.error_derivative">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">error_derivative</span></span><em class="property"><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="pre">float</span></em><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.error_derivative" title="Permalink to this definition">¶</a></dt>
<dd><p>Derivative of error.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.PIDController.get_speed">
<span class="sig-name descname"><span class="pre">get_speed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">cmd_coord</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">enc_coord</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stop</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">bool</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="reference internal" href="../_modules/neclib/device_control/antenna_pid.html#PIDController.get_speed"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neclib.device_control.antenna_pid.PIDController.get_speed" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate valid drive speed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>cmd_coord</strong></dt><dd><p>Instructed Az/El coordinate.</p>
</dd>
<dt><strong>enc_coord</strong></dt><dd><p>Az/El encoder reading.</p>
</dd>
<dt><strong>stop</strong></dt><dd><p>If <code class="docutils literal notranslate"><span class="pre">True</span></code>, the telescope won’t move regardless of the inputs.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>speed</dt><dd><p>Speed which will be commanded to motor, in original unit.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="neclib.device_control.antenna_pid.optimum_angle">
<span class="sig-prename descclassname"><span class="pre">neclib.device_control.antenna_pid.</span></span><span class="sig-name descname"><span class="pre">optimum_angle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">current</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">limits</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">margin</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">40.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold_allow_360deg</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">float</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">unit</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Literal</span><span class="p"><span class="pre">[</span></span><span class="s"><span class="pre">'deg'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'arcmin'</span></span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="s"><span class="pre">'arcsec'</span></span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'deg'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">float</span></span></span><a class="reference internal" href="../_modules/neclib/device_control/antenna_pid.html#optimum_angle"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#neclib.device_control.antenna_pid.optimum_angle" title="Permalink to this definition">¶</a></dt>
<dd><p>Find optimum unwrapped angle.</p>
<p>Azimuthal control of telescope should avoid:</p>
<ol class="arabic simple">
<li><dl class="simple">
<dt>360deg motion during observation.</dt><dd><p>This mean you should observe around -100deg, not 260deg, to command telescope of
[-270, 270]deg limit.</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Over-180deg motion.</dt><dd><p>Both 170deg and -190deg are safe in avoiding the 360deg motion, but if the
telescope is currently directed at 10deg, you should select 170deg to save time.</p>
</dd>
</dl>
</li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>current</strong></dt><dd><p>Current coordinate.</p>
</dd>
<dt><strong>target</strong></dt><dd><p>Target coordinate.</p>
</dd>
<dt><strong>limits</strong></dt><dd><p>Operation range of telescope drive.</p>
</dd>
<dt><strong>margin</strong></dt><dd><p>Safety margin around limits. While observations, this margin can be violated to
avoid suspension of scan.</p>
</dd>
<dt><strong>threshold_allow_360deg</strong></dt><dd><p>If separation between current and target coordinates is larger than this value,
360deg motion can occur. This parameter should be greater than the maximum size
of a region which can be mapped in 1 observation.</p>
</dd>
<dt><strong>unit</strong></dt><dd><p>Physical unit of given arguments and return value of this function.</p>
</dd>
</dl>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><dl class="simple">
<dt>angle</dt><dd><p>Unwrapped angle in the same unit as the input.</p>
</dd>
</dl>
</dd>
</dl>
<p class="rubric">Notes</p>
<p>This is a utility function, so there’s large uncertainty where this function
finally settle in.</p>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">optimum_angle</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="n">limits</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">270</span><span class="p">,</span> <span class="mi">270</span><span class="p">],</span> <span class="n">margin</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;deg&quot;</span><span class="p">)</span>
<span class="go">-160</span>
</pre></div>
</div>
</dd></dl>

</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="neclib.device_control.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">neclib.device_control package</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="neclib.utils.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">neclib.utils package</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022, NANTEN2 Software Team.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.4.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>